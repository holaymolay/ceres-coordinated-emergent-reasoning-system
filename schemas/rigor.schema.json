{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RigorBlock",
  "type": "object",
  "description": "Schema for optional rigor primitives (default-off, removable).",
  "properties": {
    "verifiers": {
      "type": "array",
      "description": "Outcome-driven verifiers with deterministic pass/fail semantics.",
      "items": { "$ref": "#/definitions/verifier" }
    },
    "spec_map": {
      "type": "array",
      "description": "Bidirectional mapping between spec clauses and verifiers.",
      "items": { "$ref": "#/definitions/specMap" }
    },
    "oracle": {
      "$ref": "#/definitions/oracle"
    },
    "exploit_probe": {
      "$ref": "#/definitions/exploitProbe"
    },
    "nondeterminism": {
      "$ref": "#/definitions/nondeterminism"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "verifier": {
      "type": "object",
      "required": ["id", "description", "command"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "description": { "type": "string", "minLength": 1 },
        "command": { "type": "string", "minLength": 1 },
        "args": { "type": "array", "items": { "type": "string" } },
        "expected_outputs": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Paths to expected output artifacts produced by the verifier."
        },
        "enabled": { "type": "boolean", "default": false }
      },
      "additionalProperties": false
    },
    "specMap": {
      "type": "object",
      "required": ["spec_clause_id", "verifier_id"],
      "properties": {
        "spec_clause_id": { "type": "string", "minLength": 1 },
        "verifier_id": { "type": "string", "minLength": 1 },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    },
    "oracle": {
      "type": "object",
      "required": ["script", "description"],
      "properties": {
        "script": { "type": "string", "minLength": 1 },
        "description": { "type": "string", "minLength": 1 },
        "expected_verifiers": {
          "type": "array",
          "items": { "type": "string" }
        },
        "enabled": { "type": "boolean", "default": false }
      },
      "additionalProperties": false
    },
    "exploitProbe": {
      "type": "object",
      "required": ["script", "description"],
      "properties": {
        "script": { "type": "string", "minLength": 1 },
        "description": { "type": "string", "minLength": 1 },
        "always_flag": { "type": "boolean", "default": true },
        "enabled": { "type": "boolean", "default": false }
      },
      "additionalProperties": false
    },
    "nondeterminism": {
      "type": "object",
      "required": ["manifest_path"],
      "properties": {
        "manifest_path": { "type": "string", "minLength": 1 },
        "declared_external_deps": { "type": "array", "items": { "type": "string" } },
        "flake_axes": { "type": "array", "items": { "type": "string" } },
        "enabled": { "type": "boolean", "default": false }
      },
      "additionalProperties": false
    }
  }
}
